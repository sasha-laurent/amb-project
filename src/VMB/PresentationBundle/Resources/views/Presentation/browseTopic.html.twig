{% extends '::layout.html.twig' %}

{% block h1_title %}
	<div class="row">
		<div class="col-md-9">
			{{ mainTitle }}
		</div>
		<div class="col-md-3 text-right">
			<a class="btn btn-default" data-toggle="modal" data-target="#modalAddPresentation">
				{{"actions.create" | trans }} &nbsp;<span class="left glyphicon glyphicon-plus" aria-hidden="true"></span>
			</a>
		</div>
	</div>
{% endblock %}

{% if page == 1 and (nbPages == 0 or nbPages == 1) %}
	{% set skipPagination = true %}
{% endif %}

{% block body %}
	<div class="row">
		<div class="col-md-3">
			<div class="browse-topics">
				<h3>{{ 'browse.parameters_title'|trans }}</h3>
				<hr/>
				<h4>{{ 'browse.filters'|trans }}</h4>
				<div class="row filter">
					<div class="col-md-10">{{ 'browse.default_presentations'|trans }} </div>
					<div class="col-md-2 text-right">
						<a href="{{ path(app.request.get('_route'), app.request.attributes.get('_route_params')|merge(app.request.query.all)|merge({'default':((app.request.get('default') + 1) % 2)|default(1)})) }}" class="switch">
							{% if app.request.get('default')|default(0) == 0 %}
								<span class="hidden-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="shown-value glyphicon glyphicon-minus"></span>
							{% else %}
								<span class="shown-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="hidden-value glyphicon glyphicon-minus"></span>
							{% endif %}
						</a>
					</div>
				</div>
				<div class="row filter">
					<div class="col-md-10">{{ 'browse.official'|trans }} </div>
					<div class="col-md-2 text-right">
						<a href="{{ path(app.request.get('_route'), app.request.attributes.get('_route_params')|merge(app.request.query.all)|merge({'official':((app.request.get('official') + 1) % 2)|default(1)})) }}" class="switch">
							{% if app.request.get('official')|default(0) == 0 %}
								<span class="hidden-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="shown-value glyphicon glyphicon-minus"></span>
							{% else %}
								<span class="shown-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="hidden-value glyphicon glyphicon-minus"></span>
							{% endif %}
						</a>
					</div>
				</div>
				<div class="row filter">
					<div class="col-md-10">{{ 'browse.personal_presentation'|trans }} </div>
					<div class="col-md-2 text-right">
						<a href="{{ path(app.request.get('_route'), app.request.attributes.get('_route_params')|merge(app.request.query.all)|merge({'personal':((app.request.get('personal') + 1) % 2)|default(1)})) }}" class="switch">
							{% if app.request.get('personal')|default(0) == 0 %}
								<span class="hidden-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="shown-value glyphicon glyphicon-minus"></span>
							{% else %}
								<span class="shown-value glyphicon glyphicon-ok checkedRes"></span>
								<span class="hidden-value glyphicon glyphicon-minus"></span>
							{% endif %}
						</a>
					</div>
				</div>
				
				<h4>{{ 'table.topic'|trans }}</h4>
				{% include "VMBPresentationBundle:Presentation:topicLink.html.twig" with {'links': topics, 'current': topic.id|default(null)} %}
			</div>
		</div>
		<div class="col-md-9">
			<div class="row">
				{% for entity in entities %}
				<div class="col-md-4">
					<a class="thumbnail-link" href="{{ path('presentation_show', { 'id': entity.id }) }}">
						<div class="thumbnail block-browse block-presentation{% if not entity.public %} block-presentation-private{% endif %}{% if entity.default %} block-presentation-default{% endif %}{% if entity.official %} block-presentation-official{% endif %}">
							<div class="thumbnail-description">
								<h4>{{ 'table.description'|trans }}</h4>
								<hr/>
								<p>{{ entity.description }}</p>
							</div>
							<img data-holder-rendered="true" src="{{ asset(entity.getThumbsPath) }}" style="height: 155px; width: 100%; display: block;" />
						
							<div class="caption">
								<h3 class="thumbnail-label">{{ entity.title }}</h3>
							</div>
							
							<div class="duration">
								{{ entity.durationToString }}
							</div>
							<div class="caddy-icon">
								<span class="loading_indicator_inline loading_indicator_{{entity.id}}"></span>
								
								<div class="btn-group" role="group" aria-label="...">
									{% if is_granted('ROLE_ADMIN') or entity.isOwner(app.user) %}
										<a title="{{"presentation.edit"|trans}}"href="{{ path('presentation_edit', { 'id': entity.id }) }}" type="button" class="btn btn-default"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>					
										<a title="{{"presentation.parameters"|trans}}" href="#" type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-options-{{ entity.id }}"><span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span></a>					
									{% else %}
										<a title="{{"caddy.add"|trans}}" class="btn {% if app.user.presentationIsInCaddy(entity) %}btn-info{% else %}btn-default{% endif %} presentationAddToCaddy" data-id="{{ entity.id }}"><span class="glyphicon glyphicon-star"></span></a>
									{% endif %}
									<a title="{{"presentation.copy_of"|trans}}" href="{{ path('presentation_create_copy', { 'id': entity.id }) }}" type="button" class="btn btn-default"><img width="10px" height="16px" style="{% if entity.official or entity.default %}border-top-color:rgb(255,255,255){% else %}padding-bottom:4px{% endif %};" src="{{asset('img/git-branch.svg')}}"></img></a>					
								</div>
							</div>
							
							<!-- Modal -->
							<div class="modal fade" id="modal-options-{{ entity.id }}" tabindex="-1" role="dialog" aria-labelledby="modal-options-label-{{ entity.id }}" aria-hidden="true">
							  <div class="modal-dialog">
								<div class="modal-content">
								  <div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="modal-options-label-{{ entity.id }}">{{ 'presentation.parameters'|trans({'%title%': entity.title }) }}</h4>
								  </div>
								  <div class="modal-body">
										<div class="row">
											<div class="col-md-3 text-right">{{ 'presentation.public'|trans }} :</div>
											<div class="col-md-9">
												{% if entity.public %}
													<span class="label label-success">{{ 'label.yes'|trans }}</span> <a href="{{ path('presentation_parameter', {'id': entity.id, 'value':0, 'param': 'public'}) }}"><span class="label label-default">{{ 'label.no'|trans }}</span></a>
												{% else %}
													<a href="{{ path('presentation_parameter', {'id': entity.id, 'value':1, 'param': 'public'}) }}"><span class="label label-default">{{ 'label.yes'|trans }}</span></a> <span class="label label-danger">{{ 'label.no'|trans }}</span>
												{% endif %}
											</div>
										</div><br/>
										{% if is_granted('ROLE_TEACHER') %}
										<div class="row">
											<div class="col-md-3 text-right">{{ 'presentation.official'|trans }} :</div>
											<div class="col-md-9">
												{% if entity.official %}
													<span class="label label-success">{{ 'label.yes'|trans }}</span> <a href="{{ path('presentation_parameter', {'id': entity.id, 'value':0, 'param': 'official'}) }}"><span class="label label-default">{{ 'label.no'|trans }}</span></a>
												{% else %}
													<a href="{{ path('presentation_parameter', {'id': entity.id, 'value':1, 'param': 'official'}) }}"><span class="label label-default">{{ 'label.yes'|trans }}</span></a> <span class="label label-danger">{{ 'label.no'|trans }}</span>
												{% endif %}
											</div>
										</div><br/>
										<div class="row">
											<div class="col-md-3 text-right">{{ 'presentation.default'|trans }} :</div>
											<div class="col-md-9">
												{% if entity.default %}
													<span class="label label-success">{{ 'label.yes'|trans }}</span> <a href="{{ path('presentation_parameter', {'id': entity.id, 'value':0, 'param': 'official'}) }}"><span class="label label-default">{{ 'label.no'|trans }}</span></a>
												{% else %}
													<a href="{{ path('presentation_parameter', {'id': entity.id, 'value':1, 'param': 'default'}) }}"><span class="label label-default">{{ 'label.yes'|trans }}</span></a> <span class="label label-danger">{{ 'label.no'|trans }}</span>
												{% endif %}
											</div>
										</div>
										{% endif %}
								  </div>
								  <div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'actions.close'|trans }}</button>
								  </div>
								</div>
							  </div>
							</div>
						</div>
					</a>
				</div>
				{% else %}
					<div class="col-md-12 text-center">
						<em>{{ 'browse.no_presentation'|trans }}</em>
						<br/><br/>
					</div>
				{% endfor %}
			</div>
			{% if skipPagination is not defined %}
			{% include '::pagination.html.twig' %}
			{% endif %}
		</div>
    </div>  
    <br/>
    
    {% include 'VMBPresentationBundle:Presentation:modalAddButton.html.twig' %}
{% endblock %}

{% block script %}
	{{ parent() }}
	
	<script>
		$(function() {
			if($('.collapse.in').length) {
				currentElt = $('.collapse.in');
				while($(currentElt).attr('data-level') != "0") {
					currentElt = $(currentElt).parent().closest('.collapse');
					currentElt.addClass('in');
					var id = $(currentElt).attr("id").split("collapseListGroup")[1];
					$('a[href="#collapseListGroup'+id+'"] > span')
					.removeClass('glyphicon-chevron-right')
					.addClass('glyphicon-chevron-down')
				}
			}
			var group_ids = [];
			{% for e in topics if e.__children is not empty %}
			group_ids.push({{e.id}});
			{% endfor %}
			$.each(group_ids, function(i, v){		
				var c = $('#collapseListGroup'+v);
				c.on('shown.bs.collapse', function(){
					$('a[aria-expanded="true"] > span')
					.removeClass('glyphicon-chevron-right')
					.addClass('glyphicon-chevron-down');
				});
				c.on('hidden.bs.collapse', function(){
					$('a[aria-expanded="false"] > span')
					.removeClass('glyphicon-chevron-down')
					.addClass('glyphicon-chevron-right');			
				});
			});

		});
	</script>
	{% include '::addToCaddy.html.twig' %}
{% endblock %}

